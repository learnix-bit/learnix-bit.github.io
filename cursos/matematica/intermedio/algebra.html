<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Learnix - Introducción al Álgebra</title>
<style>
/* ======= ESTILO BASE APROBADO (igual plantilla) ======= */
*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;}
body{background-color:#1e1e1e;background-image:linear-gradient(135deg,#1e1e1e,#252525);color:#e0e0e0;display:flex;flex-direction:column;min-height:100vh;}
header{background-color:#1e1e1e;display:flex;justify-content:space-between;align-items:center;padding:15px 30px;position:sticky;top:0;z-index:100;border-bottom:2px solid #2e2e2e;}
header .logo{display:flex;align-items:center;gap:10px;}
header .logo img{height:40px;}
header nav{display:flex;align-items:center;gap:8px;}
header nav a{margin-left:20px;font-weight:500;color:#bbb;text-decoration:none;transition:color .3s ease;}
header nav a:hover, header nav a.active{color:#00bcd4;}
.header-right{display:flex;align-items:center;gap:14px;}
.points{background-color:#2a2a2a;color:#ffd36e;padding:8px 12px;border-radius:999px;display:inline-flex;align-items:center;gap:8px;font-weight:700;border:1px solid #333;}
.points img{width:20px;height:20px;display:block;}
.points.pulse{animation:pulse .36s ease-in-out;}
@keyframes pulse{0%{transform:scale(1);}50%{transform:scale(1.08);}100%{transform:scale(1);}}

/* Footer / botones */
footer{background-color:#1e1e1e;text-align:center;padding:15px;border-top:2px solid #2e2e2e;margin-top:auto;}
.btn{display:inline-flex;align-items:center;gap:8px;background-color:#00bcd4;color:#fff;padding:10px 20px;border-radius:8px;margin-top:10px;transition:background .3s ease,text-transform .15s ease;text-decoration:none;cursor:pointer;border:none;}
.btn:hover{background-color:#008ba3;}
.btn img{width:20px;height:20px;}

/* Contenido */
.contenido{padding:36px 20px;max-width:980px;margin:auto;text-align:center;}
.contenido h2{font-size:2.1rem;color:#00bcd4;margin-bottom:8px;}
.lead{font-size:1.02rem;color:#cfcfcf;margin-bottom:18px;line-height:1.6;}

/* Subtemas / tarjetas */
.subtema{background-color:#2a2a2a;padding:18px;border-radius:12px;margin-bottom:16px;box-shadow:0 6px 18px rgba(0,0,0,.35);text-align:left;overflow:hidden;}
.subtema h3{color:#fff;font-size:1.15rem;margin-bottom:10px;}
.subtema p, .subtema li{color:#d0d0d0;font-size:1rem;margin-bottom:8px;line-height:1.5;}
pre.code{background:#161616;padding:12px;border-radius:8px;color:#e8e8e8;overflow:auto;font-size:.95rem;border:1px solid #262626;}

/* Layout */
.row{display:flex;gap:18px;flex-wrap:wrap;}
.col{flex:1 1 280px;min-width:260px;}

/* Inputs oscuros translúcidos (requisito) */
input[type="number"], input[type="text"], select, textarea, .quiz button{
  padding:10px;border-radius:8px;border:1px solid #2e2e2e;background:#00000040;color:#e0e0e0;outline:none;
}
input::placeholder, textarea::placeholder{color:#9aa0a6;}
label{color:#ccc;display:block;margin-bottom:6px;}

/* Resultado y feedback */
.resultado{margin-top:10px;color:#fff;font-weight:700;background: rgba(0,0,0,0.25);padding:10px;border-radius:8px;}
.feedback-list{margin-top:12px;color:#e0e0e0;text-align:left;}
.feedback-item{padding:10px;border-radius:8px;margin-bottom:8px;animation:slideIn .28s ease;}
.correct{background: rgba(0,128,0,0.12);border-left:4px solid #20c997;color:#c6ffd9;}
.wrong{background: rgba(255,0,0,0.08);border-left:4px solid #ff6b6b;color:#ffd9d9;}
@keyframes slideIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}

/* Quiz card estilos */
.quiz-card{background:#1f1f1f;border-radius:12px;padding:14px;margin-bottom:12px;transition:transform .18s ease,box-shadow .18s ease;}
.quiz-card:hover{transform:translateY(-3px);box-shadow:0 12px 24px rgba(0,0,0,.45);}
.quiz-title{color:#e5e5e5;font-weight:600;margin-bottom:8px;}
.badge{display:inline-block;padding:2px 8px;border-radius:999px;font-size:.78rem;background:#00bcd425;color:#84e7f1;border:1px solid #00bcd4;}

/* Animaciones para respuestas */
.correct-anim{animation:pop .36s ease-in-out;}
@keyframes pop{0%{transform:scale(.96);opacity:.6}100%{transform:scale(1);opacity:1}}
.wrong-anim{animation:shake .36s ease;}
@keyframes shake{0%{transform:translateX(0)}25%{transform:translateX(-5px)}50%{transform:translateX(5px)}75%{transform:translateX(-5px)}100%{transform:translateX(0)}}

/* Responsive */
@media(max-width:640px){
  .contenido{padding:18px 12px;}
  .row{flex-direction:column;}
  header{padding:12px;}
}

/* Bot flotante Chloe */
.chloe-bot{position:fixed;bottom:20px;right:20px;background-color:#00bcd4;border-radius:50%;width:60px;height:60px;display:flex;justify-content:center;align-items:center;box-shadow:0 4px 8px rgba(0,0,0,.2);}
</style>
</head>
<body>

<!-- Encabezado (plantilla igual a la que aprobaste) -->
<header>
  <div class="logo">
    <img src="../../../img/logo/logo.svg" alt="Learnix Logo">
    <h1>Learnix</h1>
  </div>
  <nav>
    <a href="../../../index.html">Inicio</a>
    <a href="../../../cursos.html" class="active">Cursos</a>
    <a href="../../../perfil.html">Perfil</a>
    <a href="../../../login.html">Login</a>
    <a href="../../../favoritos.html">Favoritos</a>
  </nav>
  <div class="header-right">
    <div class="points" title="Puntos acumulados">
      <img src="https://img.icons8.com/fluency/48/star.png" alt="star">
      <span id="puntos">0</span>
    </div>
  </div>
</header>

<main class="contenido" id="contenido">
  <h2>Introducción al Álgebra — Profundización</h2>
  <p class="lead">Definición detallada, propiedades y fórmulas, ejemplos resueltos paso a paso, herramientas interactivas, ejercicios autocorregibles, mini-quiz (5 preguntas × 10 pts), explicaciones de errores y un tip memotécnico final. Todo responsive y con animaciones profesionales.</p>

  <!-- 1) Definición Detallada -->
  <section class="subtema">
    <h3>1) Definición detallada</h3>
    <p>El <strong>álgebra</strong> es la rama de la matemática que generaliza operaciones numéricas usando símbolos (letras) que representan números desconocidos o variables. Permite formular relaciones (ecuaciones, desigualdades) y manipularlas algebraicamente para encontrar soluciones o expresar dependencias.</p>
    <p>Tipos de objetos:</p>
    <ul>
      <li><strong>Expresiones:</strong> combinación de términos (ej: <code>3x + 2y − 5</code>).</li>
      <li><strong>Ecuaciones:</strong> igualdad entre expresiones (ej: <code>2x + 3 = 9</code>).</li>
      <li><strong>Identidades:</strong> igualdad verdadera para todos los valores (ej: <code>(a+b)² = a² + 2ab + b²</code>).</li>
    </ul>
  </section>

  <!-- 2) Propiedades y fórmulas -->
  <section class="subtema">
    <h3>2) Propiedades y fórmulas esenciales</h3>
    <ul style="color:#dcdcdc;">
      <li><strong>Propiedad conmutativa (suma):</strong> <code>a + b = b + a</code></li>
      <li><strong>Propiedad asociativa (suma):</strong> <code>(a + b) + c = a + (b + c)</code></li>
      <li><strong>Distributiva:</strong> <code>a(b + c) = ab + ac</code></li>
      <li><strong>Combinar términos semejantes:</strong> <code>2x + 3x = 5x</code></li>
      <li><strong>Despeje en ecuaciones lineales:</strong> <code>ax + b = c ⇒ x = (c − b)/a</code></li>
      <li><strong>Exponentes básicos:</strong> <code>xⁿ · xᵐ = xⁿ⁺ᵐ</code>, <code>(xⁿ)ᵐ = xⁿᵐ</code></li>
    </ul>
  </section>

  <!-- 3) Ejemplos resueltos paso a paso -->
  <section class="subtema">
    <h3>3) Ejemplos resueltos (paso a paso)</h3>
    <div class="row">
      <div class="col">
        <h4>Ejemplo A — Despeje simple</h4>
        <pre class="code">
Ecuación:  2x + 5 = 13
Paso 1: 2x = 13 − 5
Paso 2: 2x = 8
Paso 3: x = 8 / 2 = 4
Solución: x = 4
        </pre>
      </div>
      <div class="col">
        <h4>Ejemplo B — Combinar términos semejantes</h4>
        <pre class="code">
Expresión: 3x + 2x − 5
Paso: (3x + 2x) − 5 = 5x − 5
Entonces la forma simplificada es 5x − 5
        </pre>
      </div>
    </div>
  </section>

  <!-- 4) Herramientas interactivas -->
  <section class="subtema">
    <h3>4) Herramientas interactivas</h3>
    <div class="row">
      <div class="col">
        <div class="tool-card" style="padding:12px;">
          <h4>Evaluador por sustitución</h4>
          <p class="small">Escribe una expresión (ej: <code>3*x + 2*y - 5</code>) y asigna valores en el formato <code>x=2,y=3</code>. Pulsa "Evaluar".</p>
          <div style="display:flex;gap:8px;flex-wrap:wrap;">
            <input id="exprEval" type="text" placeholder="ej. 3*x + 2*y - 5" style="min-width:220px">
            <input id="valsEval" type="text" placeholder="ej. x=2,y=3" style="min-width:160px">
          </div>
          <div style="margin-top:8px;">
            <button class="btn" onclick="evaluarExp()"><img src="https://img.icons8.com/color/48/calculator.png" alt="calc"> Evaluar</button>
          </div>
          <div id="outEval" class="resultado" style="margin-top:8px">—</div>
        </div>
      </div>

      <div class="col">
        <div class="tool-card" style="padding:12px;">
          <h4>Simplificador básico (única variable o lineal)</h4>
          <p class="small">Simplifica expresiones lineales (ej: <code>2x + 3x - 4</code> → <code>5x - 4</code>).</p>
          <input id="exprSimp" type="text" placeholder="ej. 2x + 3x - 4" style="min-width:260px">
          <div style="margin-top:8px;">
            <button class="btn" onclick="simplificar()">Simplificar</button>
          </div>
          <div id="outSimp" class="resultado" style="margin-top:8px">—</div>
        </div>
      </div>
    </div>
  </section>

  <!-- 5) Ejercicios prácticos autocorregibles -->
  <section class="subtema">
    <h3>5) Ejercicios prácticos (autocorregibles)</h3>
    <ol style="color:#ccc; margin-left:18px;">
      <li>Resuelve: <strong>2x + 5 = 13</strong> → x = <input id="ex1" type="text" placeholder="ej. 4" style="width:100px"></li>
      <li style="margin-top:10px;">Simplifica: <strong>3x + 2x − 5</strong> → resultado = <input id="ex2" type="text" placeholder="ej. 5x - 5" style="width:140px"></li>
      <li style="margin-top:10px;">Evalúa: <strong>3x + 2y</strong> para x=2, y=3 → resultado = <input id="ex3" type="text" placeholder="ej. 12" style="width:100px"></li>
    </ol>
    <div style="margin-top:12px;">
      <button class="btn" onclick="chequearEjercicios()"><img src="https://img.icons8.com/color/48/check.png" alt="check"> Chequear respuestas</button>
      <div id="outEj" class="resultado" style="margin-top:10px">—</div>
    </div>
  </section>

  <!-- 6) Mini-quiz -->
  <section class="subtema">
    <h3>6) Mini-Quiz (5 preguntas — 10 pts c/u)</h3>
    <p class="small">Cada acierto = 10 pts. Puntos globales (clave <code>puntosGlobales</code>) y se añaden una sola vez por este quiz. Siempre verás la explicación para cada pregunta.</p>
    <div id="quiz"></div>
    <div id="quizResultado" class="resultado" style="margin-top:12px">—</div>
    <div id="feedback" class="feedback-list" aria-live="polite"></div>
  </section>

  <!-- 7) Tip de memotecnia -->
  <section class="subtema">
    <h3>7) Tip memotécnico</h3>
    <p><strong>M.A.D.</strong> — <em>Mover, Agrupar, Dividir</em>:</p>
    <ul>
      <li><strong>Mover:</strong> pasa términos al otro lado cambiando signo.</li>
      <li><strong>Agrupar:</strong> combina términos semejantes (suma coeficientes).</li>
      <li><strong>Dividir:</strong> divide entre el coeficiente de la incógnita para despejar.</li>
    </ul>
  </section>

  <!-- Navegación -->
  <div class="acciones">
    <a href="../intermedio.html" class="btn" title="Volver a intermedio"><img src="https://img.icons8.com/color/48/home.png" alt="home"> Nivel Intermedio</a>
    <a href="potencias-raices.html" class="btn" title="Siguiente: Potencias y raíces"><img src="https://img.icons8.com/color/48/right.png" alt="next"> Siguiente</a>
    <a href="../../../cursos.html" class="btn" title="Volver a cursos" style="background:#444;"><img src="https://img.icons8.com/color/48/left.png" alt="volver"> Cursos</a>
  </div>
</main>

<!-- Bot flotante Chloe -->
<a href="#chatbot-chloe" class="chloe-bot" title="Chloe"><img src="../../../img/chatbot/chloe-icon.svg" alt="Chatbot Chloe" style="width:38px;height:38px;"></a>

<footer>
  <p>© 2025 Learnix - NeoStudio</p>
</footer>

<script>
/* ================= PUNTOS GLOBALES ================= */
const POINTS_KEY = 'puntosGlobales';
const QUIZ_FLAG_KEY = 'algebra_intro_quiz_done';
const ANSWERS_KEY = 'algebra_intro_quiz_answers';
let puntosGlobales = parseInt(localStorage.getItem(POINTS_KEY)) || 0;
document.getElementById('puntos').textContent = puntosGlobales;

/* ====== UTIL HELPERS ====== */
function updatePointsBadge(){ document.getElementById('puntos').textContent = parseInt(localStorage.getItem(POINTS_KEY)) || 0; }
function saveAnswers(key,obj){ localStorage.setItem(key, JSON.stringify(obj || {})); }
function loadAnswers(key){ const r=localStorage.getItem(key); return r?JSON.parse(r):null; }

/* ====== HERRAMIENTAS ====== */
// Evaluador: sustituye variables y evalúa (uso seguro básico)
function evaluarExp(){
  const expr = (document.getElementById('exprEval').value || '').trim();
  const vals = (document.getElementById('valsEval').value || '').trim();
  const out = document.getElementById('outEval');
  if(!expr){ out.textContent='Escribe una expresión a evaluar.'; return; }
  // parse values: x=2,y=3
  const map = {};
  if(vals){
    vals.split(',').map(s=>s.trim()).forEach(pair=>{
      const m = pair.match(/^([a-zA-Z]\w*)\s*=\s*([+\-]?\d+(\.\d+)?)$/);
      if(m) map[m[1]] = parseFloat(m[2]);
    });
  }
  // replace variables by numbers in a safe way
  let replaced = expr;
  Object.keys(map).forEach(v => {
    // add word boundary
    const re = new RegExp('\\b' + v + '\\b', 'g');
    replaced = replaced.replace(re, `(${map[v]})`);
  });
  try {
    // Basic validation: only allow digits, operators, parentheses, dots and spaces after replacement
    if(!/^[0-9+\-*/().\s]+$/.test(replaced)) { out.textContent = 'Expresión contiene símbolos no permitidos o variables sin valor.'; return; }
    const value = Function('"use strict"; return (' + replaced + ')')();
    out.innerHTML = `<strong>${expr}</strong> con ${vals || 'ningún valor'} = <strong>${value}</strong>`;
  } catch(e){
    out.textContent = 'No se pudo evaluar la expresión. Revisa sintaxis.';
  }
}

// Simplificador básico (combina coeficientes para una única variable)
function simplificar(){
  const raw = (document.getElementById('exprSimp').value || '').replace(/\s+/g,'');
  const out = document.getElementById('outSimp');
  if(!raw){ out.textContent = 'Escribe una expresión para simplificar.'; return; }
  // Regex to match terms like [+/-]?\d* x? or constants
  // We'll support linear expressions like 2x+3x-4+5x etc.
  try {
    // find variable name (first letter found)
    const varMatch = raw.match(/[a-zA-Z]/);
    if(!varMatch){ out.textContent = 'No se detectó variable. Ej: 2x+3x-4'; return; }
    const variable = varMatch[0];
    // split into terms (insert + before negatives for split)
    const normalized = raw.replace(/-/g, '+-');
    const terms = normalized.split('+').filter(Boolean);
    let coef = 0;
    let constant = 0;
    terms.forEach(t=>{
      if(t.includes(variable)){
        const c = t.replace(variable,'');
        if(c === '' || c === '+') coef += 1;
        else if(c === '-') coef += -1;
        else coef += parseFloat(c);
      } else {
        constant += parseFloat(t);
      }
    });
    const coefStr = (Math.abs(coef) === 1) ? ((coef === -1) ? '-' + variable : variable) : (coef + variable);
    const constStr = (constant === 0) ? '' : ( (constant>0) ? ' + ' + constant : ' - ' + Math.abs(constant) );
    const result = (coef === 0) ? (constant.toString()) : (coefStr + (constStr || ''));
    out.innerHTML = `<strong>${raw}</strong> → <strong>${result}</strong>`;
  } catch(e){
    out.textContent = 'No se pudo simplificar (expresión compleja).';
  }
}

/* ====== EJERCICIOS AUTOCORREGIBLES ====== */
function chequearEjercicios(){
  const out = document.getElementById('outEj');
  const ex1 = (document.getElementById('ex1').value || '').trim().replace(',','.');
  const ex2 = (document.getElementById('ex2').value || '').trim();
  const ex3 = (document.getElementById('ex3').value || '').trim().replace(',','.');

  const ok1 = Math.abs(parseFloat(ex1) - 4) < 1e-9; // 2x+5=13 -> x=4
  // For ex2 normalize spacing and compare to '5x-5' or '5x - 5' etc.
  const norm = s => s.replace(/\s+/g,'').replace(/\+/g,'+').toLowerCase();
  const ok2 = norm(ex2) === '5x-5' || norm(ex2) === '5x+-5' || norm(ex2) === '5x-5';
  const ok3 = Math.abs(parseFloat(ex3) - 12) < 1e-9; // 3*2 + 2*3 = 12

  const correct = [ok1,ok2,ok3].filter(Boolean).length;
  let details = [];
  if(!ok1) details.push('1) 2x+5=13 ⇒ 2x=8 ⇒ x=4.');
  if(!ok2) details.push('2) 3x+2x−5 = (3x+2x)−5 = 5x−5.');
  if(!ok3) details.push('3) 3x+2y con x=2,y=3 ⇒ 3·2 + 2·3 = 6+6 = 12.');

  let msg = `${correct}/3 correctas.`;
  if(correct !== 3) msg += ' — ' + details.join(' | ');
  else msg += ' ¡Perfecto!';

  out.textContent = msg;
}

/* ====== MINI-QUIZ (5 preguntas, 10 pts cada una) ====== */
const QUESTIONS = [
  {id:'q1', text:'Resuelve: 2x + 5 = 13. ¿x = ?', options:{a:'3', b:'4', c:'5'}, correct:'b',
   explanation:'2x = 13 − 5 = 8 → x = 8/2 = 4.'},
  {id:'q2', text:'Simplifica: 4x − 2x + 7.', options:{a:'2x + 7', b:'6x + 7', c:'2x − 7'}, correct:'a',
   explanation:'4x − 2x = 2x → 2x + 7.'},
  {id:'q3', text:'Evalúa 3x + 2y para x=2, y=3.', options:{a:'10', b:'12', c:'9'}, correct:'b',
   explanation:'3·2 + 2·3 = 6 + 6 = 12.'},
  {id:'q4', text:'Si x/2 = 5, entonces x = ?', options:{a:'10', b:'7', c:'2.5'}, correct:'a',
   explanation:'Multiplica ambos lados por 2: x = 5·2 = 10.'},
  {id:'q5', text:'Distributiva: a(b + c) = ?', options:{a:'ab + ac', b:'a + bc', c:'ab − ac'}, correct:'a',
   explanation:'Distribuir a entre b y c produce ab + ac.'}
];

function generarQuiz(){
  const quizDiv = document.getElementById('quiz');
  QUESTIONS.forEach((item,i)=>{
    const card = document.createElement('div'); card.className='quiz-card';
    const title = document.createElement('div'); title.className='quiz-title';
    title.innerHTML = `<span class="badge">P${i+1}</span> ${item.text}`;
    card.appendChild(title);
    Object.entries(item.options).forEach(([k,opt])=>{
      const lbl = document.createElement('label'); lbl.style.display='block'; lbl.style.margin='6px 0';
      lbl.innerHTML = `<input type="radio" name="${item.id}" value="${k}"> ${opt}`;
      card.appendChild(lbl);
    });
    quizDiv.appendChild(card);
  });
  const btn = document.createElement('button');
  btn.className='btn';
  btn.id = 'btnEnviarQuiz';
  btn.innerHTML = '<img src="https://img.icons8.com/color/48/check.png" alt="check"> Enviar Quiz';
  btn.onclick = chequearQuiz;
  quizDiv.appendChild(btn);
}

function collectUserAnswers(){
  const user = {};
  QUESTIONS.forEach(q=>{
    const el = document.querySelector(`input[name="${q.id}"]:checked`);
    if(el) user[q.id] = el.value;
  });
  return user;
}

function renderFeedback(userAnswers){
  const container = document.getElementById('feedback');
  container.innerHTML = '';
  QUESTIONS.forEach((q,idx)=>{
    const userVal = userAnswers && userAnswers[q.id] ? userAnswers[q.id] : null;
    const correctVal = q.correct;
    const isCorrect = userVal === correctVal;
    const div = document.createElement('div');
    div.className = 'feedback-item ' + (isCorrect ? 'correct' : 'wrong');
    let html = `<strong>${idx+1}) ${q.text}</strong><br>`;
    if(userVal){
      html += `Tu respuesta: <em>${q.options[userVal]}</em> — `;
      html += isCorrect ? `<span style="color:#bff6d1;">Correcta</span>` : `<span style="color:#ffd6d6;">Incorrecta</span>`;
    } else {
      html += `Tu respuesta: <em>Sin responder</em> — <span style="color:#ffd6d6;">Incorrecta</span>`;
    }
    html += `<br>Explicación: ${q.explanation}`;
    div.innerHTML = html;
    container.appendChild(div);
  });
}

function awardPointsOnceIfNeeded(points, userAnswers){
  if(localStorage.getItem(QUIZ_FLAG_KEY) === 'true'){
    return {awarded:false,reason:'completed_before'};
  }
  if(points <= 0){
    saveAnswers(ANSWERS_KEY, userAnswers || {});
    return {awarded:false,reason:'no_points'};
  }
  const current = parseInt(localStorage.getItem(POINTS_KEY)) || 0;
  localStorage.setItem(POINTS_KEY, current + points);
  localStorage.setItem(QUIZ_FLAG_KEY, 'true');
  saveAnswers(ANSWERS_KEY, userAnswers || {});
  updatePointsBadge();
  return {awarded:true,newTotal: parseInt(localStorage.getItem(POINTS_KEY))};
}

function chequearQuiz(){
  // block if already done
  if(localStorage.getItem(QUIZ_FLAG_KEY) === 'true'){
    const out = document.getElementById('quizResultado');
    out.textContent = 'Ya completaste este quiz anteriormente. No se añaden más puntos.';
    const saved = loadAnswers(ANSWERS_KEY);
    if(saved) renderFeedback(saved);
    const btn = document.getElementById('btnEnviarQuiz'); if(btn){ btn.disabled=true; btn.style.opacity=0.7; btn.textContent='Quiz completado'; }
    return;
  }

  const userAnswers = collectUserAnswers();
  let scoreCount = 0;
  QUESTIONS.forEach(q => { if(userAnswers[q.id] === q.correct) scoreCount++; });
  const puntos = scoreCount * 10;

  const res = awardPointsOnceIfNeeded(puntos, userAnswers);
  const out = document.getElementById('quizResultado');

  if(res.awarded){
    const puntosGanados = puntos;
    const puntosGlobales = parseInt(localStorage.getItem('learnix_points_globales')) || 0;
    localStorage.setItem('learnix_points_globales', puntosGlobales + puntosGanados);

    out.innerHTML = `Total: ${puntosGanados} pts (sumados a tu cuenta)`;
    const pEl = document.querySelector('.points'); if(pEl){ pEl.classList.add('pulse'); setTimeout(()=>pEl.classList.remove('pulse'),420); }
    const btn = document.getElementById('btnEnviarQuiz'); if(btn){ btn.disabled=true; btn.style.opacity=0.7; btn.textContent='Quiz completado'; }
  } else {
    if(res.reason === 'completed_before'){
      out.textContent = 'Ya completaste este quiz anteriormente. No se añaden puntos.';
    } else if(res.reason === 'no_points'){
      out.textContent = `Resultado: ${scoreCount} / ${QUESTIONS.length}. No obtuviste puntos (necesitas al menos 1 acierto). Intenta de nuevo.`;
      // save last attempt
      saveAnswers(ANSWERS_KEY, userAnswers);
    } else {
      out.textContent = `Resultado: ${scoreCount} / ${QUESTIONS.length}.`;
    }
  }
  renderFeedback(userAnswers);
}

/* Init: cargar estado anterior si lo hay */
window.addEventListener('DOMContentLoaded', ()=>{
  generarQuiz();
  updatePointsBadge();
  // If quiz already completed, show saved feedback and disable button
  if(localStorage.getItem(QUIZ_FLAG_KEY) === 'true'){
    const btn = document.getElementById('btnEnviarQuiz'); if(btn){ btn.disabled=true; btn.style.opacity=0.7; btn.textContent='Quiz completado'; }
    const saved = loadAnswers(ANSWERS_KEY);
    if(saved){ document.getElementById('quizResultado').textContent='Ya completaste este quiz. Puntos añadidos anteriormente.'; renderFeedback(saved); }
  } else {
    const last = loadAnswers(ANSWERS_KEY);
    if(last && Object.keys(last).length){
      document.getElementById('quizResultado').textContent='Último intento guardado (sin reclamar puntos). Revisa feedback y vuelve a intentar.';
      renderFeedback(last);
    }
  }
});
</script>
</body>
</html>
